;/*
 * MTA v1.1.5
 * (c) 2014-2019
 * 美团点评 - 性能平台 
 */
!function(){"use strict";function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function t(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(n,!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function s(t){return"number"==typeof t}var f=Array.prototype,e=Object.prototype,h=e.hasOwnProperty,n=e.toString,w=function(t){return"function"==typeof t};function d(t){if("undefined"!=typeof JSON&&w(JSON.stringify))return JSON.stringify(t);switch(u(t)){case"string":return'"'.concat(t,'"');case"boolean":case"number":return String(t);case"object":if(null===t)return"null";var e=!1,n="",r="";for(var o in t)if(h.call(t,o)){r="'".concat(o,"'");var i=d(t[o]);i.length&&(e?n+=",":e=!0,n+=p(t)?i:'"'.concat(r,'":').concat(i))}return p(t)?"[".concat(n,"]"):"{".concat(n,"}");default:return""}}function g(t){if("object"!==u(t)&&"function"!=typeof t||null===t)return[];if(w(Object.keys))return Object.keys(t);var e=[];for(var n in t)h.call(t,n)&&e.push(n);return e}function p(t){return w(Array.isArray)?Array.isArray(t):"[object Array]"===n.call(t)}function v(t,e,n){if(w(f.map))return t.map(e,n);for(var r=[],o=t.length,i=0;i++<o;)r.push(e.call(n,t[i],i,t));return r}function m(t,n){if(w(f.forEach))t.forEach(function(t,e){n(t,e)});else for(var e=t.length,r=0;r++<e;)n(t[r],r)}function y(t,e,n){if(w(f.filter))return t.filter(e,n);for(var r=[],o=t.length,i=0;i++<o;)e.call(n,t[i],i,t)&&r.push(t[i]);return r}function E(t){var e=document.cookie,n=e.indexOf(";",t);return-1===n&&(n=e.length),decodeURIComponent(e.substring(t,n))}var _={get:function(t){for(var e=document.cookie,n="".concat(t,"="),r=n.length,o=e.length,i=0;i<o;){var a=i+r;if(e.substring(i,a)===n)return E(a);if(0===(i=e.indexOf(" ",i)+1))break}return""},set:function(t,e,n,r,o,i){o=o||function(){var t=document.domain;if("localhost:"===t)return"";"undefined"!=typeof M&&M.DOMAIN_HOST&&(t=".".concat(M.DOMAIN_HOST));"www."===t&&(t=t.substring(0,4));return t}();var a=(r?"; path=".concat(r):"")+(o?"; domain=".concat(o):"")+(i?"; secure":"");document.cookie=e?"".concat(t,"=").concat(encodeURIComponent(String(e)))+(n?"; expires=".concat(n):"")+a:"".concat(t,"=; expires=Thu, 01 Jan 1970 00:00:01 GMT")+(r?"; path=".concat(r):"")+a},getExpire:function(t,e,n){var r=new Date;if(s(t)&&s(e)&&s(n))return r.setDate(r.getDate()+parseInt(t,10)),r.setHours(r.getHours()+parseInt(e,10)),r.setMinutes(r.getMinutes()+parseInt(n,10)),r.toUTCString()}},b={};function S(t,e,n,r){var o=3<arguments.length&&void 0!==r&&r;if(t)return t.addEventListener?t.addEventListener(e,n,o):t.attachEvent?t.attachEvent("on".concat(e),n):void 0}var k={on:function(t,e){w(e)&&(b[t]||(b[t]=[])).push(e)},emit:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[0],o=e.slice(1);if(b[r])for(var i=0;i<b[r].length;i++)b[r][i].apply(this,o)},addEvent:function(t,e){S(window,t,e,2<arguments.length&&void 0!==arguments[2]&&arguments[2])},removeEvent:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return window.removeEventListener?window.removeEventListener(t,e,n):window.detachEvent?window.detachEvent("on".concat(t),e):void 0},addEventToSelectors:function(t,n,r){var o=3<arguments.length&&void 0!==arguments[3]&&arguments[3];t&&0<t.length?t.forEach(function(t){var e=document.getElementById(t);e&&S(e,n,r,o)}):S(window,n,r,o)}};function C(t,e){return t<=0||e<=0||t-e<=0?0:parseInt(t-e,10)}function T(t,e){var n,r={};for(n in t)r[n]=t[n];for(n in e)e.hasOwnProperty(n)&&void 0!==e[n]&&(r[n]=e[n]);return r}var j=function(){var n="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)};function r(){r=function(){},n.Symbol||(n.Symbol=t)}var o=0;function t(t){return"jscomp_symbol_"+(t||"")+o++}function i(){r();var t=n.Symbol.iterator;t=t||(n.Symbol.iterator=n.Symbol("iterator")),"function"!=typeof Array.prototype[t]&&e(Array.prototype,t,{configurable:!0,writable:!0,value:function(){return a(this)}}),i=function(){}}function a(t){var e=0;return function(t){return i(),(t={next:t})[n.Symbol.iterator]=function(){return this},t}(function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}})}function s(t){i();var e=t[Symbol.iterator];return e?e.call(t):a(t)}function c(t){if(!(t instanceof Array)){t=s(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}var u=0;var l="img script iframe link audio video source".split(" ");function f(t,e){for(var n=(t=s(t)).next();!n.done;n=t.next())if(n=n.value,e.includes(n.nodeName.toLowerCase())||f(n.children,e))return!0;return!1}function h(t,e){if(2<t.length)return performance.now();for(var n=[],r=(e=s(e)).next();!r.done;r=e.next())r=r.value,n.push({timestamp:r.start,type:"requestStart"}),n.push({timestamp:r.end,type:"requestEnd"});for(r=(e=s(t)).next();!r.done;r=e.next())n.push({timestamp:r.value,type:"requestStart"});for(n.sort(function(t,e){return t.timestamp-e.timestamp}),t=t.length,e=n.length-1;0<=e;e--)switch((r=n[e]).type){case"requestStart":t--;break;case"requestEnd":if(2<++t)return r.timestamp;break;default:throw Error("Internal Error: This should never happen")}return 0}function d(t){t=t||{},this.w=!!t.useMutationObserver,this.u=t.minValue||null,t=window.__tti&&window.__tti.e;var e=window.__tti&&window.__tti.o;this.a=t?t.map(function(t){return{start:t.startTime,end:t.startTime+t.duration}}):[],e&&e.disconnect(),this.b=[],this.f=new Map,this.j=null,this.v=-1/0,this.i=!1,this.h=this.c=this.s=null,function(o,i){var a=XMLHttpRequest.prototype.send,s=u++;XMLHttpRequest.prototype.send=function(t){for(var e=[],n=0;n<arguments.length;++n)e[n-0]=arguments[n];var r=this;return o(s),this.addEventListener("readystatechange",function(){4===r.readyState&&i(s)}),a.apply(this,e)}}(this.m.bind(this),this.l.bind(this)),function(i,a){var s=fetch;fetch=function(t){for(var o=[],e=0;e<arguments.length;++e)o[e-0]=arguments[e];return new Promise(function(e,n){var r=u++;i(r),s.apply(null,[].concat(c(o))).then(function(t){a(r),e(t)},function(t){a(t),n(t)})})}}(this.m.bind(this),this.l.bind(this)),function(r){r.c=new PerformanceObserver(function(t){for(var e=(t=s(t.getEntries())).next();!e.done;e=t.next())if("resource"===(e=e.value).entryType&&(r.b.push({start:e.fetchStart,end:e.responseEnd}),p(r,h(r.g,r.b)+5e3)),"longtask"===e.entryType){var n=e.startTime+e.duration;r.a.push({start:e.startTime,end:n}),p(r,n+5e3)}}),r.c.observe({entryTypes:["longtask","resource"]})}(this),this.w&&(this.h=function(n){var t=new MutationObserver(function(t){for(var e=(t=s(t)).next();!e.done;e=t.next())"childList"==(e=e.value).type&&f(e.addedNodes,l)?n(e):"attributes"==e.type&&l.includes(e.target.tagName.toLowerCase())&&n(e)});return t.observe(document,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["href","src"]}),t}(this.B.bind(this)))}function g(t){t.i=!0;var e=0<t.a.length?t.a[t.a.length-1].end:0,n=h(t.g,t.b);p(t,Math.max(n+5e3,e))}function p(i,t){!i.i||i.v>t||(clearTimeout(i.j),i.j=setTimeout(function(){var t=performance.timing.navigationStart,e=h(i.g,i.b);t=(window.a&&window.a.A?1e3*window.a.A().C-t:0)||performance.timing.domContentLoadedEventEnd-t;if(i.u)var n=i.u;else n=performance.timing.domContentLoadedEventEnd?(n=performance.timing).domContentLoadedEventEnd-n.navigationStart:null;var r=performance.now();null===n&&p(i,Math.max(e+5e3,r+1e3));var o=i.a;(e=r-e<5e3?null:r-(e=o.length?o[o.length-1].end:t)<5e3?null:Math.max(e,n))&&(i.s(e),clearTimeout(i.j),i.i=!1,i.c&&i.c.disconnect(),i.h&&i.h.disconnect()),p(i,performance.now()+1e3)},t-performance.now()),i.v=t)}d.prototype.getFirstConsistentlyInteractive=function(){var e=this;return new Promise(function(t){e.s=t,"complete"==document.readyState?g(e):window.addEventListener("load",function(){g(e)})})},d.prototype.m=function(t){this.f.set(t,performance.now())},d.prototype.l=function(t){this.f.delete(t)},d.prototype.B=function(){p(this,performance.now()+5e3)},n.Object.defineProperties(d.prototype,{g:{configurable:!0,enumerable:!0,get:function(){return[].concat(c(this.f.values()))}}});var v={getFirstConsistentlyInteractive:function(t){return t=t||{},"PerformanceLongTaskTiming"in window?new d(t).getFirstConsistentlyInteractive():Promise.resolve(null)}};return"undefined"!=typeof module&&module.exports?module.exports=v:"function"==typeof define&&define.amd?define("ttiPolyfill",[],function(){return v}):v}.call(window),O=function(){function e(t){o(this,e),a(this,"_MAX_URL_LENGTH",2083),this.url=t}return t(e,[{key:"config",value:function(t){this.url=t}},{key:"send",value:function(t){d(t).length&&this._post(t)}},{key:"_sendByScript",value:function(t){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="".concat(this.url,"?").concat(t);var n=document.getElementsByTagName("script")[0];n.parentNode&&n.parentNode.insertBefore(e,n)}},{key:"_post",value:function(t){!function(t){if("file:"!==window.location.protocol){var e,n=c({method:"GET",async:!0},t);if(window.XDomainRequest)try{(e=new XMLHttpRequest).open(n.method,n.url),e.send(d(n.data))}catch(t){}else if(window.XMLHttpRequest&&"withCredentials"in(e=new XMLHttpRequest))try{e.open(n.method,n.url,n.async),e.setRequestHeader("Content-Type","text/plain"),e.send(d(n.data))}catch(t){}}}({url:this.url,method:"POST",data:t})}}]),e}(),P=function(){function r(){o(this,r),a(this,"_COOKIE_USER_TRACKING","__mta");var t=window.screen,e=window.navigator,n=this._getViewport();this.screen=t?"".concat(t.width,"x").concat(t.height):"-",this.viewport="".concat(n.width,"x").concat(n.height),this.javaEnabled=e&&e.javaEnabled()?1:0,this.ua=e.userAgent,this.isFirstVisit=!1,this._setCookie()}return t(r,[{key:"getInfo",value:function(){return{sr:this.screen,vp:this.viewport,csz:document.cookie?document.cookie.length:0,ua:this.ua,uuid:this.uuid,url:location.href,sdkVersion:"__VERSION_",region:"",operator:"",network:this._getNetwork(),container:"",os:""}}},{key:"_setCookie",value:function(){var t=_.getExpire(720,0,0),e=this._getCurrentTime(),n=_.get(this._COOKIE_USER_TRACKING);if(n){var r=n.split(".");r[2]=r[3],r[3]=String(e),r[4]=String(parseInt(r[4],10)+1),_.set(this._COOKIE_USER_TRACKING,r.join("."),t),this.uuid=r[1]}else{var o=this._hashInfo();n=[o,e,e,e,1].join("."),_.set(this._COOKIE_USER_TRACKING,n,t),this.isFirstVisit=!0,this.uuid=String(o)}}},{key:"_getCurrentTime",value:function(){return(new Date).getTime()}},{key:"_hashInfo",value:function(){for(var t=window,e=t.navigator,n=t.history.length,r=e.appName+e.appVersion+this._getEnvLanguage()+e.platform+e.userAgent+this.javaEnabled+this.screen+(document.cookie?document.cookie:"")+(document.referrer?document.referrer:""),o=r.length;0<n;)r+=n--^o++;return function(t){var e,n=1,r=0;if(t)for(n=0,e=t.length-1;0<=e;e--)n=0!==(r=266338304&(n=(n<<6&268435455)+(r=t.charCodeAt(e))+(r<<14)))?n^r>>21:n;return n}(r)}},{key:"_getViewport",value:function(){var t={width:document.body&&document.body.clientWidth||0,height:document.body&&document.body.clientHeight||0};return null!==window.innerWidth&&(t={width:window.innerWidth,height:window.innerHeight}),"CSS1Compat"===document.compatMode&&(t={width:document.documentElement&&document.documentElement.clientWidth||0,height:document.documentElement&&document.documentElement.clientHeight||0}),t}},{key:"_getEnvLanguage",value:function(){return(navigator&&(navigator.language?navigator.language:navigator.browserLanguage?navigator.browserLanguage:"-")).toLowerCase()}},{key:"_getNetwork",value:function(){var t=_.get("network");if(!t){var e=window.navigator.userAgent,n=/NetType\/([a-zA-Z0-9]+)/;e&&n.test(e)&&(t=e.match(n)[1])}return t||""}}]),r}(),I="error",x=["project","page_url","real_url","resource_url","sec_category","level","ts","content"],L=["line","column","tags"].concat(x),A=function(){function n(t){if(o(this,n),t){var e;for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);this.parse(t)}}return t(n,[{key:"parse",value:function(){this.level||(this.level=I),this.ts||(this.ts=+new Date),this.sec_category||(this.sec_category="default")}},{key:"isEqual",value:function(t){return this.sec_category===t.sec_category&&this.resource_url===t.resource_url&&this.column===t.column&&this.line===t.line&&this.content===t.content}},{key:"update",value:function(t){for(var e in t)void 0!==t[e]&&-1!==L.indexOf(e)&&(this[e]=t[e]);return this}},{key:"updateTags",value:function(t){var e=T(this.tags||{},t);return this.tags=e,this}},{key:"toJson",value:function(){var e=this,n={};return x.map(function(t){void 0!==e[t]&&(n[t]=e[t])}),n}}]),n}(),R="metrics_cache";var N={isSupport:function(){var t="local_test";try{localStorage.setItem(t,1),localStorage.removeItem(t)}catch(t){return!1}return!0}(),get:function(){if(this.isSupport){var t=[];try{var e=localStorage.getItem(R);e&&(t=JSON.parse(e))}catch(t){console.log(t)}return t}},add:function(t){if(this.isSupport&&t instanceof Array){var e=this.get();t=t.concat(e);try{localStorage.setItem(R,JSON.stringify(t))}catch(t){console.log(t)}}},clear:function(){if(this.isSupport)try{localStorage.removeItem(R)}catch(t){console.log(t)}}},F=function(){function n(t){var e=this;o(this,n),this.cfgManager=t,this.jsErrorEnable=t.jsError&&t.jsError.enable,this.jsErrorApi=t.url,this.beacon=new O(t.url,t.snifferUrl),this.client=new P,this.clientInfo=this.client.getInfo(),this.cache=[],this.cacheSending={},this.comboTimeout=0,this.timeLimit=Date.now(),this.errorCount=0,this.isTimeLimit=!1,this.detectLeave(),this.getJsErrorConfig=function(t){return e.cfgManager.jsError&&e.cfgManager.jsError[t]}}return t(n,[{key:"_handleError",value:function(e){try{var t=this.getJsErrorConfig("onErrorPush");if(t instanceof Function&&(e=t(e)),e instanceof A||void 0===e)return e;console.log("onErrorPush\u65b9\u6cd5\u8fd4\u56de\u7ed3\u679c\u6709\u8bef")}catch(t){return console.log("onErrorPush\u65b9\u6cd5\u5904\u7406\u6709\u8bef",t),e}}},{key:"parseWindowError",value:function(t,e,n,r,o){try{o&&o.stack?this.push(o):"string"==typeof t&&this._push({sec_category:t,resource_url:e,line:n,column:r})}catch(t){this.reportSystemError(t)}}},{key:"parsePromiseUnhandled",value:function(t){if(t)try{var e=t.reason;e&&(e instanceof Error?this.push(e,{sec_category:"unhandledrejection"}):this._push({sec_category:"unhandledrejection",content:e}))}catch(t){console.log(t)}}},{key:"parseConsoleError",value:function(){try{var t=[].slice.call(arguments);if(!t||!t.length)return;for(var e=[],n=0;n<t.length;n++){var r=t[n];"string"!=typeof t[n]&&(r=t[n]instanceof window.Error?JSON.stringify(t[n].stack):JSON.stringify(t[n])),e.push(r)}e&&e.length&&this._push({sec_category:"consoleError",content:e.join(" ")})}catch(t){this.reportSystemError(t)}}},{key:"detectLeave",value:function(){var c=this,u=arguments;try{var l=window.onbeforeunload;window.onbeforeunload=function(){var t,e=c.addCacheExtension(),n=c.cacheSending;if(Object.keys(n))for(var r in n)if(n.hasOwnProperty(r)&&void 0!==n[r]){var o=n[r],i=o.xhr,a=o.cache;try{i.abort()}catch(t){console.log(t)}t=e.concat(a)}if(t&&t.length)if(window.navigator.sendBeacon&&c.getJsErrorConfig("useSendBeacon")){var s=function(t,e){if(!e)return t;var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(r+"="+e[r]);return~t.indexOf("?")?t+"&"+n.join("&"):t+"?"+n.join("&")}(c.cfgManager.url,{beacon:1});window.navigator.sendBeacon(s,function(t){return"c="+encodeURIComponent(JSON.stringify(t))}(t))}else c.getJsErrorConfig("disableCache")||N.add(t);l&&l.apply(c,u)}}catch(t){console.log(t)}}},{key:"checkCache",value:function(){var t=this;if(!this.getJsErrorConfig("disableCache")){var e=N.get();e&&e.length&&setTimeout(function(){t.doSend({url:t.cfgManager.url,data:e,success:function(){N.clear()}})},1500)}}},{key:"reportSystemError",value:function(t){t&&t.stack&&(this.cache.push(new A({project:"metrics",page_url:"default",real_url:window.location.href,sec_category:t.msg||t.name||"parseError",content:JSON.stringify(t.stack),flow_ids:this.cfgManager.getFlowIds()})),this.send(!0))}},{key:"_processError",value:function(e){function c(t){return{sec_category:"Invalid_Error",content:"object"===u(t)?JSON.stringify(t):t}}try{return function(t){var e=t.line,n=t.column,r=t.message||t.name||"";if(t.stack){var o=t.stack.match("https?://[^\n]+");o=o?o[0]:"";var i=/https?:\/\/(\S)*\.js/,a="";i.test(o)&&(a=o.match(i)[0]);var s=o.match(":(\\d+):(\\d+)");return s=s||[0,0,0],{sec_category:r,content:function(t){return t&&t.stack||""}(t),line:void 0!==e?e:s[1],column:void 0!==n?n:s[2],resource_url:a}}return c(t)}(e)}catch(t){return this.reportSystemError(e),c(e)}}},{key:"_push",value:function(t,e){t=this.parse(t),this.push(new A(t),e)}},{key:"_pushResource",value:function(){var t=this.cfgManager.get("resource").sample;Math.random()>t||this._push.apply(this,arguments)}},{key:"parse",value:function(t){return t.project||(t.project=this.clientInfo.token),t.page_url||(t.page_url=location.href||"default"),t.real_url=window.location.href,t}},{key:"push",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:{};if(t&&!(Math.random()>this.getJsErrorConfig("sample")))if(t instanceof A||(t instanceof Error?t=this._processError(t):"string"==typeof t?t={sec_category:t}:"object"===u(t)&&(t={sec_category:t.name,content:t.msg}),t=this.parse(t),t=new A(t)),t&&t.content&&t.content.length>=this.getJsErrorConfig("maxSize"))console.log("[Error]: \u9519\u8bef\u957f\u5ea6\u5927\u4e8e".concat(this.getJsErrorConfig("maxSize")));else{t.update(n);var r=this.getJsErrorConfig("filters"),o=!0;if(this.getJsErrorConfig("noScriptError")&&0===t.sec_category.indexOf("Script error"))return!1;if(r&&r.length)for(var i=0;i<r.length;i++){if(!r[i].fn(t))return!1}var a=this.getJsErrorConfig("ignoreList");if(a&&a.length)for(var s=0;s<a.length;s++){var c=a[s];if(0===t.sec_category.indexOf(c)){o=!1;break}}o&&(this.isExist(t)||(this.onPush&&this.onPush(t),(t=this._handleError(t))&&(this.cache.push(t),this.send())))}}},{key:"isExist",value:function(t){for(var e=0;e<this.cache.length;e++){var n=this.cache[e];if(n instanceof A||(n=new A(n)),n.isEqual(t))return!0}return!1}},{key:"report",value:function(){this.push.apply(this,arguments),this.send(!0)}},{key:"send",value:function(t){var r=this,e=this.cfgManager,o=this.comboTimeout,i=this.getJsErrorConfig("maxNum")||100,a=this.getJsErrorConfig("maxTime")||6e4,s=Date.now()-this.timeLimit;this.isTimeLimit||(this.timeLimit=Date.now()),this.isTimeLimit=!0;function n(){if(r.cache.length){clearTimeout(o),o=0,r.onSubmit&&r.onSubmit(r.cache);var t=r.addCacheExtension(),e=+new Date;try{if(r.errorCount=r.errorCount+r.cache.length,s<=a){if(r.errorCount>=i)return}else r.isTimeLimit=!1,r.errorCount=0}catch(t){console.log(t)}var n=r.doSend({url:r.cfgManager.url,data:t,success:function(){r.nextCache=[],r.cacheSending[e]=void 0},fail:function(){r.getJsErrorConfig("disableCache")||N.add(r.nextCache)}});r.cacheSending[e]={xhr:n,cache:t},r.nextCache=t,r.cache=[]}}var c=e.jsError&&e.jsError.delay||100;t?n():o||-1===c||(o=setTimeout(n,c))}},{key:"addCacheExtension",value:function(){var t=this.cfgManager,e=this.cache,n=[],r=t.jsError&&t.jsError.ext;if(!e||!e.length)return n;for(var o=0;o<e.length;o++){var i=e[o];r&&"object"===u(r)&&(i=T(i.toJson(),r)),i.flow_ids=this.cfgManager.getFlowIds().join(";");var a={type:"jsError",value:1,ts:i.ts,tags:i};n.push(a)}return n}},{key:"doSend",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};if(e&&e.data){e.beforeSend&&e.beforeSend();var n=[{category:"met_fe_web_log",env:c({token:this.cfgManager.token},this.clientInfo),logs:e.data}];this.beacon.send(n),e.success()}}}]),n}();var J={activate:"activate",create:"create",config:"config",tag:"tag",timing:"sendTiming",count:"sendCount",gauge:"sendGauge",send:"send",stop:"stop",on:"_on",enable:"enable",test:"testStart",testEnd:"testEnd",sendJsError:"sendJsError"},q=function(){function s(t){var e=this;o(this,s),a(this,"_PERF_CATEGORY","fe_perf_web"),a(this,"_SNIFFER_CATEGORY_V1","met_fe_web_log"),a(this,"_SNIFFER_REG",/^sniffer/),a(this,"_SEND_DELAY",100),this.trackerConfig=c({useCombo:!0,sampleRate:100,url:"".concat(location.protocol,"//dreport.meituan.net"),getFlowIds:function(){return e._testQueue.map(function(t){return t.data})}},t),this.client=new P,this.beacon=new O(this.trackerConfig.url),this._visitCode=this._random(),this._queue=[],this._snifferQueueV1=[],this._testQueue=[],this._tags={},this._testQueueId=0,this.jsErrCore=null}return t(s,[{key:"create",value:function(t,e){this._app=t,this.trackerConfig=c({},this.trackerConfig,{},e,{sampleRate:5,token:t}),this.send("resources")}},{key:"config",value:function(t,e){var n=this;if(void 0!==e)switch(t){case"sampleRate":"number"==typeof e&&(this.trackerConfig.sampleRate=e);break;case"useCombo":"boolean"==typeof e&&(this.trackerConfig.useCombo=e);break;case"jsError":this.trackerConfig.jsError=e,this.jsErrCore=new F(this.trackerConfig,this),window._mta_js_error_queue&&window._mta_js_error_queue.map(function(t){var e;(e=n.jsErrCore).parseWindowError.apply(e,l(t))}),window._mta_js_error_queue=[],function(t){var e=window.onerror;if(t){t.cfgManager;if(!1!==t.jsErrorEnable)window.onerror=function(){t.parseWindowError.apply(t,arguments),e&&e.apply(window,arguments)},(window.addEventListener||window.attachEvent)("unhandledrejection",function(){t.parsePromiseUnhandled.apply(t,arguments)});if(!0===t.getJsErrorConfig("enableConsole")){if(!window.console||!window.console.error)return;var n=window.console.error;window.console.error=function(){t.parseConsoleError.apply(t,arguments),n&&n.apply(window.console,arguments)}}}}(this.jsErrCore);break;case"beaconImage":"string"==typeof e&&-1===e.indexOf("frep.meituan.")&&this.beacon.config(this.trackerConfig.url=e);break;case"scrollFPS":"object"===u(e)&&(this.trackerConfig.scrollFPS=e)}}},{key:"tag",value:function(t,e){"string"==typeof t&&t.length&&(void 0!==u(e)?this._tags[t]=e:delete this._tags[t])}},{key:"execute",value:function(){for(var t=[],e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var o=0;o<n.length;o++)try{var i=n[o];if(w(i))n[o](this);else{var a=(i=[].slice.call(i,0))[0],s=this[J[a]].apply(this,i.slice(1));s&&t.push(s)}}catch(t){t++}return 1===t.length?t[0]:t}},{key:"push",value:function(){return this.execute.apply(this,arguments)}},{key:"send",value:function(t,e,n,r){var o=this;if(t&&!(-1<["xhr-dispatch","xhr-result.load","browser.xhr"].indexOf(t)))if("resources"!==t)if("jsError"!==t){if(!(e&&e.url&&/catfront|dreport/.test(e.url))){var i=s.plugins[t];i&&(e=i.data(e),r=i.type);var a={};e&&(a[t]=e,this._push(r||"timer",a,n)),this._timer&&(window.clearTimeout(this._timer),this._timer=null),this._timer=window.setTimeout(function(){o._sendData()},this._SEND_DELAY)}}else this.sendJsError(e);else this._sendResources()}},{key:"sendJsError",value:function(t,e){this.jsErrCore.report(t,e)}},{key:"clearTestTimer",value:function(e,n){var t=this._testQueue.findIndex(function(t){return t.data===e&&t.id===n});-1<t&&(clearTimeout(this._testQueue[t].timer),this._testQueue.splice(t,1))}},{key:"testEnd",value:function(e,n,t,r){-1<this._testQueue.findIndex(function(t){return t.data===e&&t.id===n})&&(r?(t.log&&delete t.log,this.send("flow.sucess",e,t,"flow.success")):(t.log&&(t.log=JSON.stringify(t.log)),this.send("flow.fail",e,t,"flow.fail")),this.clearTestTimer(e,n))}},{key:"testStart",value:function(r,o,t){var i=this;o.log=o.log||{};var a=this._testQueueId;this._testQueueId++;var e=setTimeout(function(){i.testEnd(r,a,o,!1)},t||2e3);this._testQueue.push({data:r,timer:e,tags:o,id:a});function n(t,e){var n=!0;if(t)try{n=t()}catch(t){n=!1,console.warn("test callback error",t)}if(e)if(o.log&&"string"==typeof o.log)try{o.log=JSON.parse(o.log),o.log=Object.assign({},o.log,e)}catch(t){console.warn("log:",o.log),console.warn("add extral log failed",t)}else o.log&&"object"===u(o.log)?o.log=Object.assign({},o.log,e):o.log=e;i.testEnd(r,a,o,n)}return n.cancel=function(){return i.clearTestTimer(r,a)},n.test=function(t,e){return n(t,e)},n}},{key:"sendTiming",value:function(t,e,n){this.send(t,e||1,n,"timer")}},{key:"sendCount",value:function(t,e,n){this.send(t,e||1,n,"counter")}},{key:"sendGauge",value:function(t,e,n){this.send(t,e||1,n,"gauge")}},{key:"enable",value:function(t,e){if(this._isSampleHit()&&("fcp"===t||"tti"===t||"scrollFPS"===t)){var r=this,n=s.plugins[t],o=function(t,e,n){r.sendTiming(t,e,n)};if(n)try{"scrollFPS"===t?n.data(this.trackerConfig[t],e,o):n.data(e,o)}catch(t){}}}},{key:"activate",value:function(t,e,n){if(this._isSampleHit()&&"fps"===t){var r=this,o=s.plugins.fps;if(o)try{this._fps=o.data(e,n,function(t,e,n){r.sendTiming(t,e,n)}),this._fps.activate()}catch(t){}}}},{key:"stop",value:function(t){this._fps&&"fps"===t&&this._fps.stop()}},{key:"_push",value:function(t,e,n){var r=g(e)[0];if("flow.fail"===t||"flow.success"===t){var o={flow_name:e[r],page_url:location.href.split("?")[0],real_url:location.href},i=n.log;this._snifferQueueV1.push({type:t,data:a({},t,1),tags:o,ts:String((new Date).valueOf()),raw:i})}else this._queue.push({type:t,data:e,tags:n||this._tags,ts:String((new Date).valueOf())})}},{key:"_on",value:function(t,e){k.on(t,e)}},{key:"_sendResources",value:function(){if(!(.1<Math.random())){var t=s.plugins.resources;if(t)try{var e=t.data();if(!e)return;for(var n=0;n<e.length;n++){var r=e[n];this.sendTiming("browser.resource",r.data,r.tags)}}catch(t){console.error(t)}}}},{key:"_formatAndSendData",value:function(t,e,n){var r=this,o=null,i=[];if(e.length)if(t)1===e.length?i=this._formatLogType(e[0]):m(e,function(t){var e;(e=i).push.apply(e,l(r._formatLogType(t)))}),o=this._formatReportData(i,n),k.emit("data",o),this.beacon.send(o);else for(var a=0;a<e.length;a++){var s=this._formatLogType(e[a]);o=this._formatReportData(s,n),k.emit("data",o),this.beacon.send(o)}}},{key:"_sendData",value:function(){if(this._isSampleHit()){var t=this.trackerConfig.useCombo;this._formatAndSendData(t,this._queue),this._queue=[],this._formatAndSendData(t,this._snifferQueueV1,"flow"),this._snifferQueueV1=[]}}},{key:"_formatLogType",value:function(t){var e=t.data,n=t.tags,r=t.ts,o=(t.type,g(e)[0]),i=g(e[o]),a="browser.ajax"===o,s=y(i,function(t){return"url"!==t&&"method"!==t});return t.raw?[{type:o,value:e[o],tags:n,ts:r,raw:t.raw}]:a?y(v(s,function(t){return{ts:r,type:"".concat(o,".").concat(t),value:String(Number(e[o][t])),tags:c({url:e[o].url,method:e[o].method.toUpperCase()},n)}}),function(t){var e=t.type,n=t.value;return!("browser.ajax.error"===e&&"0"===n)}):i.length?v(i,function(t){return{type:"".concat(o,".").concat(t),value:e[o][t],tags:n,ts:r}}):[{type:o,value:e[o],tags:n,ts:r}]}},{key:"_formatReportData",value:function(t,e){var n=this.client.getInfo(),r=c({token:this._app,url:location.href,sdkVersion:"__VERSION_"},n),o=this._PERF_CATEGORY;"flow"===e&&(o=this._SNIFFER_CATEGORY_V1);var i={category:o,logs:t,env:{}};return m(g(r),function(t){i.env[t]=r[t]}),[i]}},{key:"_random",value:function(){return Math.round(2147483647*Math.random())}},{key:"_isSampleHit",value:function(){return this._visitCode%1e4<100*this.trackerConfig.sampleRate}}],[{key:"addPlugin",value:function(t,e){if(!w(e.data))throw new Error("Can't add plugin ".concat(t,". The plugin object of data props should be")+" a function, but its type is ".concat(u(e.data)));s.plugins[t]=e}}]),s}();a(q,"plugins",{});function D(t){var e=window[t];if(w(e)&&!(e.q&&e.q.isInitialized&&e.q.initialized())){var n=new q,r=e?e.q:[];if(e.q=n,p(r)){var o=[],i=[];r.forEach(function(t){t&&!t.length?o.push(t):i.push(t)}),n.execute.apply(n,i),o.map(function(t){return t.hanlder=n.execute.apply(n,[t.arguments]),t.hasCanceled?t.hanlder.cancel():t.hasEnded&&t.hanlder.test(function(){return t.success},t.log),t})}}}function H(e){var n={};return m(g(e),function(t){0<e[t]&&(n[t]=e[t])}),n}var V,B={type:"timer",data:function(t){var e=0<arguments.length&&void 0!==t?t:0,n=window.performance||window.mozPerformance;if(n&&n.timing&&!(e<=0)){var r=e-n.timing.navigationStart;if(!(r<=0))return r}}},G={type:"timer",data:function(t,e,n){var r=1<arguments.length&&void 0!==e?e:{},o=2<arguments.length?n:void 0,i=window.requestAnimationFrame;if(w(i)){var a=t&&t.duration||6e4,s=t&&t.maxCount||null,c=0,u=0,l=null,f=null;return{activate:function(){k.addEvent("blur",g),k.addEvent("focus",d),k.addEvent("visibilitychange",p),document.hasFocus()&&(h(),m())},stop:v}}function h(){u++,l=i(h)}function d(){(!s||c<s)&&(u=0,h(),m())}function g(){l&&cancelAnimationFrame(l),f&&clearInterval(f)}function p(){document.hidden?g():d()}function v(){l&&cancelAnimationFrame(l),f&&clearInterval(f),k.removeEvent("blur",g),k.removeEvent("focus",d),k.removeEvent("visibilitychange",p)}function m(){f&&clearInterval(f),f=setInterval(function(){l&&cancelAnimationFrame(l),c++;try{o&&o("browser.page",{fps:Math.min(60,u/(a/1e3))},r)}catch(t){}u=0,s&&s<=c?v():h()},a)}}},Q={type:"timer",data:function(){var t=window.performance||window.mozPerformance||window.msPerformance||window.webkitPerformance;if(t){var e=t.timing,r={redirect:C(e.fetchStart,e.navigationStart),dns:C(e.domainLookupEnd,e.domainLookupStart),connect:C(e.connectEnd,e.connectStart),network:C(e.connectEnd,e.navigationStart),send:C(e.responseStart,e.requestStart),receive:C(e.responseEnd,e.responseStart),backend:C(e.responseEnd,e.requestStart),render:C(e.loadEventEnd,e.loadEventStart),dom:C(e.domComplete,e.domLoading),frontend:C(e.loadEventEnd,e.domLoading),load:C(e.loadEventEnd,e.navigationStart),domReady:C(e.domContentLoadedEventStart,e.navigationStart),interactive:C(e.domInteractive,e.navigationStart),ttf:C(e.fetchStart,e.navigationStart),ttr:C(e.requestStart,e.navigationStart),ttdns:C(e.domainLookupStart,e.navigationStart),ttconnect:C(e.connectStart,e.navigationStart),ttfb:C(e.responseStart,e.navigationStart)};if("object"===("undefined"==typeof M?"undefined":u(M))&&M.subresources&&M.subresources.names&&void 0!==window.SubResoucesTiming){var n=M.subresources.lastImage||"",o=M.subresources.firstImage||"",i=new window.SubResoucesTiming(M.subresources.names,n,o);i.length&&"fsImg"===i[i.length-1].id&&(r.atf=i[i.length-1].start,r.c_atf=i[i.length-1].start-C(e.responseStart,e.navigationStart))}try{t.getEntriesByType("paint").forEach(function(t,e,n){"first-paint"===t.name&&(r.firstPaint=t.startTime)})}catch(t){}if(!r.firstPaint&&e.msFirstPaint&&"number"==typeof e.msFirstPaint&&(r.firstPaint=C(e.msFirstPaint,e.navigationStart)),!r.firstPaint&&window.chrome&&window.chrome.loadTimes){var a=window.chrome.loadTimes();r.firstPaint=Math.round(1e3*(a.firstPaintTime-a.startLoadTime))}return("number"!=typeof r.firstPaint||r.firstPaint<0)&&(r.firstPaint=void 0),"undefined"!=typeof M&&M.TimeTracker&&M.TimeTracker.fst&&(r.firstScreen=C(M.TimeTracker.fst,e.navigationStart)),r}}},U={type:"timer",data:function(){var t=window.performance||window.mozPerformance;if(t&&t.getEntriesByType){for(var e=t.getEntriesByType("resource"),n=[],r=0;r<e.length;r++){var o=e[r],i="".concat(o.name,"?"),a={load:parseInt(o.duration,10),redirect:C(o.redirectEnd,o.redirectStart),appcache:C(o.domainLookupStart,o.fetchStart),dns:C(o.domainLookupEnd,o.domainLookupStart),network:C(o.connectEnd,o.connectStart),send:C(o.requestStart,o.connectEnd),ttfb:C(o.responseStart,o.requestStart),receive:C(o.responseEnd,o.responseStart)};n.push({data:H(a),tags:{path:i.slice(0,i.indexOf("?")),type:o.initiatorType}})}return n}}},z={type:"timer",data:function(t,e){var r=0<arguments.length&&void 0!==t?t:{},o=1<arguments.length?e:void 0,n=window.performance||window.mozPerformance||window.msPerformance||window.webkitPerformance,i=100,a=20,s=null,c=0;n&&n.getEntriesByType&&!function t(){c++,s&&(window.clearTimeout(s),s=null);var e=n.getEntriesByType("paint");e&&e.length?e.forEach(function(t,e,n){"first-contentful-paint"===t.name&&function(t){try{o&&o("browser.page",{fcp:t},r)}catch(t){}}(t.startTime)}):c<a&&(s=window.setTimeout(t,i))}()}},K={type:"timer",data:function(t,e){var n=0<arguments.length&&void 0!==t?t:{},r=1<arguments.length?e:void 0;j&&j.getFirstConsistentlyInteractive().then(function(t){!function(t){try{r&&r("browser.page",{tti:t},n)}catch(t){}}(t)})}},W={type:"timer",data:function(t,e,n){var r=1<arguments.length&&void 0!==e?e:{},o=2<arguments.length?n:void 0,i=window.requestAnimationFrame;if(w(i)){var a,s,c,u=t&&t.selectors||[],l=[],f=0,h=!1,d=0,g=0,p=0,v=function(t){var e=(h=t)?"scrollstart":"scrollstop";window.dispatchEvent(new Event(e))};k.addEventToSelectors(u,"scroll",function(){h||v(!0),clearTimeout(s),s=setTimeout(function(){v(!1)},50)}),k.addEvent("scrollstart",function(){console.log("scrollstart"),clearTimeout(c),d=performance.now(),a=i(y)}),k.addEvent("scrollstop",function(){console.log("scrollstop"),g=performance.now(),10<=l.length&&(p+=g-d,f+=l.filter(function(t){return d<=t&&t<=g-1e3/60}).length),l=[],window.cancelAnimationFrame(a),c=setTimeout(function(){if(10<=f){var t=1e3*f/p,e=Math.round(10*t)/10;m(e)}l=[],f=p=g=d=0},1e3)});var m=function(t){try{o&&o("browser.page",{scrollFPS:t},r)}catch(t){}},y=function t(e){l.push(e),a=i(t)}}}};q.addPlugin("browser.page.business",B),q.addPlugin("fps",G),q.addPlugin("page",Q),q.addPlugin("resources",U),q.addPlugin("fcp",z),q.addPlugin("tti",K),q.addPlugin("scrollFPS",W),V=function(){if(window.MeituanAnalyticsObject){var t=window.MeituanAnalyticsObject;"[object String]"===Object.prototype.toString.call(t)&&(t=[t]);for(var e=0;e<t.length;e++)D(t[e])}},"complete"===document.readyState?V():k.addEvent("load",V)}();
