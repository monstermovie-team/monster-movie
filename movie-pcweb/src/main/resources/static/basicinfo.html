<div class="profile-title">
	基本信息
</div>
<div class="avatar-container">
	<div class="avatar-content">
		<img id="touxiang" class="J-setted-avatar" src="javascript:void(0);">
		<div class="J-upload-avatar-w upload-avatar-image">
			<form id="uploadForm" enctype="multipart/form-data">
				<input type="file" id="fileUpload" name="file" multiple="multiple">
				<input type="button" id="changeTx" class="J-upload-avatar upload-btn" value="更换头像">
			</form>
		</div>
		<div class="tips">支持JPG,JPEG,PNG格式,且文件需小于1M</div>
	</div>
</div>
<form id="J-userexinfo-form" class="userexinfo-form">
	<div class="userexinfo-form-section">
		<p>昵称：</p>
		<span>
			<input type="text" name="customerName" id="customerName" class="ui-checkbox" placeholder="2-15个字，支持中英文、数字">
		</span>
	</div>
	<div class="userexinfo-form-section">
		<p>账号：</p>
		<span>
			<input type="text" name="customerAccounts" id="customerAccounts" readonly="readonly" class="ui-checkbox">
		</span>
	</div>
	<div class="userexinfo-form-section">
		<p>密码：</p>
		<span>
			<input type="password" name="customerPassword" id="customerPassword" readonly="readonly" class="ui-checkbox">
		</span>
	</div>
	<div class="userexinfo-form-section">
		<p>性别：</p>
		<span>
			<input type="radio" name="gender" id="userexinfo-form-gender-1" value="1" class="ui-radio radio-first">
			<label for="userexinfo-form-gender-1">男</label>
		</span>
		<span>
			<input type="radio" name="gender" id="userexinfo-form-gender-2" value="2" class="ui-radio">
			<label for="userexinfo-form-gender-2">女</label>
		</span>
	</div>
	<div class="date-picker userexinfo-form-section">
		<p>生日：</p>
		<span>
			<div class="ui-select">
				<select name="year" class="ui-select" id="year">
					<option>--</option>
					<option value="2020">2020</option>
					<option value="2019">2019</option>
					<option value="2018">2018</option>
					<option value="2017">2017</option>
					<option value="2016">2016</option>
					<option value="2015">2015</option>
					<option value="2014">2014</option>
					<option value="2013">2013</option>
					<option value="2012">2012</option>
					<option value="2011">2011</option>
					<option value="2010">2010</option>
					<option value="2009">2009</option>
					<option value="2008">2008</option>
					<option value="2007">2007</option>
					<option value="2006">2006</option>
					<option value="2005">2005</option>
					<option value="2004">2004</option>
					<option value="2003">2003</option>
					<option value="2002">2002</option>
					<option value="2001">2001</option>
					<option value="2000">2000</option>
					<option value="1999">1999</option>
					<option value="1998">1998</option>
					<option value="1997">1997</option>
					<option value="1996">1996</option>
					<option value="1995">1995</option>
					<option value="1994">1994</option>
					<option value="1993">1993</option>
					<option value="1992">1992</option>
					<option value="1991">1991</option>
					<option value="1990">1990</option>
					<option value="1989">1989</option>
					<option value="1988">1988</option>
					<option value="1987">1987</option>
					<option value="1986">1986</option>
					<option value="1985">1985</option>
					<option value="1984">1984</option>
					<option value="1983">1983</option>
					<option value="1982">1982</option>
					<option value="1981">1981</option>
					<option value="1980">1980</option>
					<option value="1979">1979</option>
					<option value="1978">1978</option>
					<option value="1977">1977</option>
					<option value="1976">1976</option>
					<option value="1975">1975</option>
					<option value="1974">1974</option>
					<option value="1973">1973</option>
					<option value="1972">1972</option>
					<option value="1971">1971</option>
					<option value="1970">1970</option>
					<option value="1969">1969</option>
					<option value="1968">1968</option>
					<option value="1967">1967</option>
					<option value="1966">1966</option>
					<option value="1965">1965</option>
					<option value="1964">1964</option>
					<option value="1963">1963</option>
					<option value="1962">1962</option>
					<option value="1961">1961</option>
					<option value="1960">1960</option>
					<option value="1959">1959</option>
					<option value="1958">1958</option>
					<option value="1957">1957</option>
					<option value="1956">1956</option>
					<option value="1955">1955</option>
					<option value="1954">1954</option>
					<option value="1953">1953</option>
					<option value="1952">1952</option>
					<option value="1951">1951</option>
					<option value="1950">1950</option>
					<option value="1949">1949</option>
					<option value="1948">1948</option>
					<option value="1947">1947</option>
					<option value="1946">1946</option>
					<option value="1945">1945</option>
					<option value="1944">1944</option>
					<option value="1943">1943</option>
					<option value="1942">1942</option>
					<option value="1941">1941</option>
				</select>
			</div>
			<span class="tip">年</span>
		</span>
		<span>
			<div class="ui-select">
				<select name="month" class="ui-select" id="month">
					<option>--</option>
					<option value="01">1</option>
					<option value="02">2</option>
					<option value="03">3</option>
					<option value="04">4</option>
					<option value="05">5</option>
					<option value="06">6</option>
					<option value="07">7</option>
					<option value="08">8</option>
					<option value="09">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
				</select>
			</div>
			<span class="tip">月</span>
		</span>
		<span>
			<div class="ui-select">
				<select name="day" class="ui-select" id="day">
					<option>--</option>
					<option value="01">1</option>
					<option value="02">2</option>
					<option value="03">3</option>
					<option value="04">4</option>
					<option value="05">5</option>
					<option value="06">6</option>
					<option value="07">7</option>
					<option value="08">8</option>
					<option value="09">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
					<option value="13">13</option>
					<option value="14">14</option>
					<option value="15">15</option>
					<option value="16">16</option>
					<option value="17">17</option>
					<option value="18">18</option>
					<option value="19">19</option>
					<option value="20">20</option>
					<option value="21">21</option>
					<option value="22">22</option>
					<option value="23">23</option>
					<option value="24">24</option>
					<option value="25">25</option>
					<option value="26">26</option>
					<option value="27">27</option>
					<option value="28">28</option>
					<option value="29">29</option>
					<option value="30">30</option>
					<option value="31">31</option>
				</select>
			</div>
			<span class="tip">日</span>
		</span>
	</div>

	<div class="userexinfo-form-section expand-list">
		<p>兴趣：</p>
		<div class="interest-list">
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-1" value="美食" class="ui-checkbox">
				<label for="userexinfo-form-interest-1">美食</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-2" value="动漫" class="ui-checkbox">
				<label for="userexinfo-form-interest-2">动漫</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-3" value="摄影" class="ui-checkbox">
				<label for="userexinfo-form-interest-3">摄影</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-4" value="电影" class="ui-checkbox">
				<label for="userexinfo-form-interest-4">电影</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-5" value="体育" class="ui-checkbox">
				<label for="userexinfo-form-interest-5">体育</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-6" value="财经" class="ui-checkbox">
				<label for="userexinfo-form-interest-6">财经</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-7" value="音乐" class="ui-checkbox">
				<label for="userexinfo-form-interest-7">音乐</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-8" value="游戏" class="ui-checkbox">
				<label for="userexinfo-form-interest-8">游戏</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-9" value="科技" class="ui-checkbox">
				<label for="userexinfo-form-interest-9">科技</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-10" value="旅游" class="ui-checkbox">
				<label for="userexinfo-form-interest-10">旅游</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-11" value="文学" class="ui-checkbox">
				<label for="userexinfo-form-interest-11">文学</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-12" value="公益" class="ui-checkbox">
				<label for="userexinfo-form-interest-12">公益</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-13" value="汽车" class="ui-checkbox">
				<label for="userexinfo-form-interest-13">汽车</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-14" value="时尚" class="ui-checkbox">
				<label for="userexinfo-form-interest-14">时尚</label>
			</span>
			<span>
				<input type="checkbox" name="interest" id="userexinfo-form-interest-15" value="宠物" class="ui-checkbox">
				<label for="userexinfo-form-interest-15">宠物</label>
			</span>
			<!-- <span class="bottom-tips">选择你的兴趣使你获得个性化的电影推荐哦</span> -->
		</div>
	</div>
	<div class="userexinfo-form-section" style="margin-top:-25px;">
		<p>个性签名：</p>
		<span>
			<input type="text" name="signature" id="customerSign" class="ui-checkbox" placeholder="20个字以内" value="">
		</span>
	</div>
	<div class="userexinfo-bottom-section clearfix">
		<input type="button" id="save" class="form-save-btn" value="保存">
	</div>

</form>
<script>
	$(function() {
		load();

		function load() {
			$.ajax({
				url: 'getCustomerInfo',
				method: 'get',
				success: function(result) {
					if (result.code == 200) {
						$("#touxiang").attr("src", result.data.customerPhoto);
						$("#customerName").val(result.data.customerName);
						$("#customerAccounts").val(result.data.customerAccounts);
						$("#customerPassword").val(result.data.customerPassword);
						if (result.data.customerSex == "男") {
							$("#userexinfo-form-gender-1").prop("checked", "checked");
						} else if (result.data.customerSex == "女") {
							$("#userexinfo-form-gender-2").prop("checked", "checked");
						}
						var birthday = result.data.customerBirthday;
						var year = birthday.split("-")[0];
						var month = birthday.split("-")[1];
						var day = birthday.split("-")[2];
						$("#year").val(year);
						$("#month").val(month);
						$("#day").val(day);
						var intrest = result.data.customerInterest;
						// $(intrest.split(",")).each(function(index,e){
						// 	$("input[name='interest'][value='"+e+"']").prop("checked",true);
						// });
						var subs = intrest.split("，");
						for (var i = 0; i < subs.length; i++) {
							$('input[name="interest"][value="' + subs[i] + '"]').attr("checked", true);
						}
						$("#customerSign").val(result.data.customerSign);
					} else {
						alert(result.message);
					}
				}
			});
		}

		//文件上传
		$("#fileUpload").change(function(e) {
			var imgBox = e.target;
			uploadImg($('#touxiang'), imgBox)
		});

		function uploadImg(element, tag) {
			var file = tag.files[0];
			var imgSrc;
			if (!/image\/\w+/.test(file.type)) {
				alert("看清楚，这个需要图片！");
				return false;
			}
			var reader = new FileReader();
			reader.readAsDataURL(file);
			reader.onload = function() {
				console.log(this.result);
				imgSrc = this.result;
				$(element).attr("src", imgSrc);
			};
		}

		//日期格式化
		Date.prototype.format = function(format) {
			var o = {
				"M+": this.getMonth() + 1, //month
				"d+": this.getDate(), //day
				"H+": this.getHours(), //hour
				"m+": this.getMinutes(), //minute
				"s+": this.getSeconds(), //second
				"q+": Math.floor((this.getMonth() + 3) / 3), //quarter
				"S": this.getMilliseconds() //millisecond
			}

			if (/(y+)/.test(format)) {
				format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
			}

			for (var k in o) {
				if (new RegExp("(" + k + ")").test(format)) {
					format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
				}
			}
			return format;
		}

		//字符串转日期
		function stringToDate(dateStr, separator) {
			if (!separator) {
				separator = "-";
			}
			var dateArr = dateStr.split(separator);
			var year = parseInt(dateArr[0]);
			var month;
			if (dateArr[1].indexOf("0") == 0) {
				month = parseInt(dateArr[1].substring(1));
			} else {
				month = parseInt(dateArr[1]);
			}
			var day = parseInt(dateArr[2]);
			var date = new Date(year, month - 1, day);
			return date;
		}

		$("#save").off('click').on('click', function() {
			var customerName = $("input[name='customerName']").val();
			var customerSex = $("input[name='gender']:checked").val() == 1 ? '男' : '女';
			var year = $("#year").val();
			var month = $("#month").val();
			var day = $("#day").val();
			var tt = year + "-" + month + "-" + day;
			var date = stringToDate(tt);
			var customerBirthday = date.format("yyyy-MM-dd");
			var customerInterest = "";
			$("input[name='interest']:checked").each(function() {
				customerInterest += $(this).val() + "，";
			});
			customerInterest = customerInterest.substring(0, customerInterest.length - 1);
			var customerSign = $("#customerSign").val();
			alert(customerName + "|" + customerSex + "|" + customerBirthday + "|" + customerInterest + "|" + customerSign);
			$.ajax({
				url: 'updCustomerInfo',
				method: 'post',
				//data:"customerName="+customerName+"&customerSex="+customerSex+"&customerBirthday="+customerBirthday+"&customerInterest="+customerInterest+"&customerSign="+customerSign,
				data: {
					'customerName': customerName,
					'customerSex': customerSex,
					'customerBirthday': customerBirthday,
					'customerInterest': customerInterest,
					'customerSign': customerSign
				},
				success: function(result) {
					if (result.code == 200) {
						alert(result.message);
					} else {
						alert(result.message);
					}
				}
			});
		});

		$("#fileUpload").on('change',function(){
			var form = new FormData(document.getElementById("uploadForm"));
			$.ajax({
				url:'uploadTx',
				method:'post',
				data:form,
				contentType: false,
				processData: false,
				success:function(result){
					if(result.code==200){
						alert(result.message);
					}else{
						alert(result.message);
					}
				}
			});
		});
	});
</script>